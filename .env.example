# =============================================================================
# Environment Variables Example - Master Template
# =============================================================================
# Copy this file to .env.development or .env.production and update with your values
#
# For Development:
#   cp .env.example .env.development
#
# For Production:
#   cp .env.example .env.production
#
# NOTE: When running via Docker Compose (make up-dev / make up-prod),
#       ONLY root .env files are used. Package-level .env files are ignored.
#
# =============================================================================
# ENVIRONMENT FILE MAPPING
# =============================================================================
# | Docker Compose File        | Environment File   | Usage                                            |
# | -------------------------- | ------------------ | ------------------------------------------------ |
# | docker-compose.prod.yml   | .env.production    | Production deployment                            |
# | docker-compose.dev.yml    | .env.development   | Docker development (all services in containers)  |
# | docker-compose.local.yml  | .env.local         | Local development (infra in Docker, apps native) |
#
# =============================================================================
# IMPORTANT DIFFERENCES: .env.development vs .env.local
# =============================================================================
# .env.development (Docker Development):
#   - Uses Docker service names for inter-container communication:
#     * SERVER_RESTAPI_URL=http://rest-api:4000/api (Docker service name)
#     * REDIS_HOST=redis (Docker service name)
#     * DATABASE_URL is set by Docker Compose (not in file)
#
# .env.local (Local Development):
#   - Uses localhost for native apps connecting to Docker infrastructure:
#     * SERVER_RESTAPI_URL=http://localhost:4000/api (localhost)
#     * REDIS_HOST=localhost (localhost)
#     * DATABASE_URL=postgresql://...@localhost:5432/... (explicit connection string)
#   - Auto-created from .env.development when you run 'make dev-local' or 'make infra-up'
#   - Gitignored - safe for local customizations
#
# NOTE: .env.local is automatically created from .env.development on first run.
#       You only need to create .env.development manually.
# =============================================================================

# =============================================================================
# APPLICATION - General Configuration
# =============================================================================
ENVIRONMENT=development
NODE_ENV=development
APP_NAME=docsplus

# =============================================================================
# SECURITY
# =============================================================================
# Generate a strong random secret for production (min 32 characters)
# Use: openssl rand -base64 64
JWT_SECRET=dev-secret-key-change-in-production-min-32-chars

# =============================================================================
# INFRASTRUCTURE - Shared Services
# =============================================================================
DB_USER=docsplus
DB_PASSWORD=CHANGE_ME_STRONG_PASSWORD
DB_PORT=5432
REDIS_PORT=6379

# =============================================================================
# SUPABASE - Server-side (containers → host/internal)
# =============================================================================
SUPABASE_URL=http://host.docker.internal:54321
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0

# =============================================================================
# SUPABASE - Client-side (browser → direct access)
# =============================================================================
NEXT_PUBLIC_SUPABASE_URL=http://localhost:54321
NEXT_PUBLIC_SUPABASE_WS_URL=ws://localhost:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0

# =============================================================================
# REST API SERVICE
# =============================================================================
APP_PORT=4000
EXPOSE_APP_PORT=4000
# For .env.development (Docker): Use Docker service name
# For .env.local (Local): Use localhost
SERVER_RESTAPI_URL=http://rest-api:4000/api
NEXT_PUBLIC_RESTAPI_URL=http://localhost:4000/api/v1
REST_LOG_LEVEL=debug

# =============================================================================
# HOCUSPOCUS WEBSOCKET SERVICE
# =============================================================================
HOCUSPOCUS_PORT=4001
EXPOSE_HOCUSPOCUS_PORT=4001
NEXT_PUBLIC_PROVIDER_URL=ws://localhost:4001
WS_LOG_LEVEL=debug

# Hocuspocus Logger Configuration
HOCUSPOCUS_LOGGER=true
HOCUSPOCUS_LOGGER_ON_CONNECT=true
HOCUSPOCUS_LOGGER_ON_DISCONNECT=true
HOCUSPOCUS_LOGGER_ON_LOAD_DOCUMENT=true
HOCUSPOCUS_LOGGER_ON_CHANGE=true
HOCUSPOCUS_LOGGER_ON_UPGRADE=true
HOCUSPOCUS_LOGGER_ON_REQUEST=true
HOCUSPOCUS_LOGGER_ON_LISTEN=true
HOCUSPOCUS_LOGGER_ON_DESTROY=true
HOCUSPOCUS_LOGGER_ON_CONFIGURE=true

# Hocuspocus Throttle Configuration
HOCUSPOCUS_THROTTLE=true
HOCUSPOCUS_THROTTLE_ATTEMPTS=100
HOCUSPOCUS_THROTTLE_BANTIME=60000

# =============================================================================
# WORKER SERVICE
# =============================================================================
WORKER_HEALTH_PORT=4002
EXPOSE_WORKER_HEALTH_PORT=4002
WORKER_LOG_LEVEL=debug

# =============================================================================
# WEBAPP SERVICE
# =============================================================================
NEXT_PUBLIC_SSE_URL=http://localhost:3000/sse

# =============================================================================
# DATABASE - PostgreSQL Connection Pool
# =============================================================================
# For .env.development (Docker): DATABASE_URL is set by Docker Compose (not needed here)
# For .env.local (Local): DATABASE_URL must be explicitly set (see .env.local for example)
# Example for .env.local:
# DATABASE_URL=postgresql://docsplus:CHANGE_ME_STRONG_PASSWORD@localhost:5432/docsplus?connection_limit=10&pool_timeout=10&sslmode=prefer
DB_POOL_SIZE=10
DB_IDLE_TIMEOUT=300000
DB_CONNECT_TIMEOUT=10000
DB_STATEMENT_TIMEOUT=60000
DB_QUERY_TIMEOUT=60000
DB_LOG_LEVEL=

# =============================================================================
# REDIS - Connection & Configuration
# =============================================================================
REDIS=true
# For .env.development (Docker): Use Docker service name 'redis'
# For .env.local (Local): Use 'localhost'
REDIS_HOST=redis
REDIS_TLS=false
REDIS_CONNECT_TIMEOUT=30000
REDIS_COMMAND_TIMEOUT=60000
REDIS_KEEPALIVE=30000
REDIS_MAX_RETRIES=10
REDIS_LOG_LEVEL=

# =============================================================================
# BULLMQ - Queue Configuration
# =============================================================================
BULLMQ_CONCURRENCY=5
BULLMQ_RATE_LIMIT_MAX=100
BULLMQ_RATE_LIMIT_DURATION=1000
QUEUE_LOG_LEVEL=

# =============================================================================
# STORAGE - Configuration
# =============================================================================
# Storage type: 'local' or 's3'
STORAGE_TYPE=local
PERSIST_TO_LOCAL_STORAGE=true
LOCAL_STORAGE_PATH=./temp/hypermultimedia

# DigitalOcean Spaces / AWS S3
DO_STORAGE_ENDPOINT=https://nyc3.digitaloceanspaces.com
DO_STORAGE_REGION=nyc3
DO_STORAGE_BUCKET=your-bucket-name
DO_STORAGE_ACCESS_KEY_ID=your-access-key
DO_STORAGE_SECRET_ACCESS_KEY=your-secret-key
DO_STORAGE_MAX_FILE_SIZE=10485760
S3_CONNECT_TIMEOUT=10000
S3_REQUEST_TIMEOUT=30000
STORAGE_LOCAL_LOG_LEVEL=
STORAGE_S3_LOG_LEVEL=

# Legacy webapp storage variables (for backward compatibility)
NEXT_PUBLIC_SPACES_KEY=
NEXT_PUBLIC_SPACES_SECRET=

# =============================================================================
# NGINX - Reverse Proxy
# =============================================================================
NGINX_HTTP_PORT=3000
NGINX_HTTPS_PORT=443

# =============================================================================
# CORS - Cross-Origin Resource Sharing
# =============================================================================
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001

# =============================================================================
# RATE LIMITING
# =============================================================================
RATE_LIMIT_MAX=1000

# =============================================================================
# LOGGING - Global Configuration
# =============================================================================
# Global default level (others inherit unless overridden)
# Options: fatal | error | warn | info | debug | trace | silent
LOG_LEVEL=debug

# Per-service log levels (leave empty to inherit LOG_LEVEL)
HTTP_LOG_LEVEL=
DOCUMENTS_CONTROLLER_LOG_LEVEL=
HEALTH_CONTROLLER_LOG_LEVEL=
DOCUMENTS_SERVICE_LOG_LEVEL=
MEDIA_SERVICE_LOG_LEVEL=
HEALTH_SERVICE_LOG_LEVEL=
JWT_LOG_LEVEL=

# =============================================================================
# SERVICE SCALING - Production Replicas
# =============================================================================
REST_REPLICAS=2
WS_REPLICAS=3
WORKER_REPLICAS=2
WEBAPP_REPLICAS=2

# =============================================================================
# BUILD METADATA
# =============================================================================
BUILD_ID=development-build
GIT_HASH=dev

# =============================================================================
# EMAIL - Notification Service (SMTP via Nodemailer)- optional and will be removed soon
# =============================================================================
# Sends email notifications when new documents are created.
# Requires: bun add nodemailer

# Common settings
EMAIL_FROM=notifications@yourdomain.com
NEW_DOCUMENT_NOTIFICATION_EMAILS=admin@company.com,ops@company.com
APP_URL=https://yourdomain.com
EMAIL_LOG_LEVEL=

# SMTP Configuration
# Gmail: Use App Password (not your regular password)
# Setup guide: https://support.google.com/accounts/answer/185833
# 1. Enable 2FA on Gmail
# 2. Go to: https://myaccount.google.com/apppasswords
# 3. Generate app password for "Mail"
# 4. Use that 16-char password below
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=you@gmail.com
SMTP_PASS=your-16-char-app-password
SMTP_SECURE=false

# =============================================================================
# ANALYTICS & EXTERNAL SERVICES
# =============================================================================
# Google Analytics
NEXT_PUBLIC_GA_ID=

# Google OAuth - Required for Supabase Google Sign-In
# Get credentials from: https://console.cloud.google.com/apis/credentials
# Authorized redirect URI: http://localhost:54321/auth/v1/callback
GOOGLE_CLIENT_ID=
GOOGLE_SECRET=
NEXT_PUBLIC_GOOGLE_CLIENT_ID=

# TipTap Pro (Optional)
TIPTAP_PRO_TOKEN=

# Elastic APM (Optional)
NEXT_PUBLIC_ELASTIC_APM_SERVER_URL=
NEXT_PUBLIC_ELASTIC_APM_SECRET_TOKEN=
