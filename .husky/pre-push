#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Pre-push checks starting..."

# Type-check and build admin-dashboard (catches TS errors)
echo "ğŸ“¦ Building admin-dashboard..."
if bun run --filter "@docs.plus/admin-dashboard" build:local; then
    echo "âœ… Admin dashboard build successful"
else
    echo "âŒ Admin dashboard build failed. Push aborted."
    exit 1
fi

# Build hocuspocus-server (backend)
echo "ğŸ“¦ Building hocuspocus-server..."
if bun run --filter "@docs.plus/hocuspocus-server" build; then
    echo "âœ… Hocuspocus server build successful"
else
    echo "âŒ Hocuspocus server build failed. Push aborted."
    exit 1
fi

# Build webapp
echo "ğŸ“¦ Building webapp..."
if bun run --filter "@docs.plus/webapp" build:local; then
    echo "âœ… Webapp build successful"
else
    echo "âŒ Webapp build failed. Push aborted."
    exit 1
fi

echo "ğŸš€ All pre-push checks passed. Proceeding with push."
