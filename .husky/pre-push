#!/bin/sh

echo "ğŸ” Pre-push checks starting..."
echo ""

# Track overall status
FAILED=0

# ============================================
# 1. Build TipTap Extensions (webapp deps)
# ============================================
echo "ğŸ“¦ Building TipTap extensions..."
for ext in extension-hyperlink extension-hypermultimedia extension-indent extension-inline-code; do
    if bun run --filter "@docs.plus/${ext}" build >/dev/null 2>&1; then
        echo "  âœ… ${ext}"
    else
        echo "  âŒ ${ext} build failed"
        FAILED=1
    fi
done

if [ $FAILED -ne 0 ]; then
    echo ""
    echo "âŒ Extension builds failed. Push aborted."
    exit 1
fi

echo ""

# ============================================
# 2. Build Admin Dashboard
# ============================================
echo "ğŸ“¦ Building admin-dashboard..."
if bun run --filter "@docs.plus/admin-dashboard" build:local >/dev/null 2>&1; then
    echo "  âœ… admin-dashboard build OK"
else
    echo "  âŒ admin-dashboard build failed"
    FAILED=1
fi

if [ $FAILED -ne 0 ]; then
    echo ""
    echo "âŒ Admin dashboard build failed. Push aborted."
    exit 1
fi

echo ""
echo "ğŸš€ All pre-push checks passed. Proceeding with push."
echo ""
echo "ğŸ’¡ Note: Webapp build is handled by CI/CD pipeline."
