#!/bin/sh

echo "ğŸ” Pre-push checks starting..."

# Build admin-dashboard (catches TS errors via Next.js build)
echo "ğŸ“¦ Building admin-dashboard..."
if bun run --filter "@docs.plus/admin-dashboard" build:local; then
    echo "âœ… Admin dashboard build successful"
else
    echo "âŒ Admin dashboard build failed. Push aborted."
    exit 1
fi

# Build TipTap extensions (dependencies for webapp)
echo "ğŸ“¦ Building TipTap extensions..."
for ext in extension-hyperlink extension-hypermultimedia extension-indent extension-inline-code; do
    if bun run --filter "@docs.plus/${ext}" build; then
        echo "  âœ… ${ext}"
    else
        echo "  âŒ ${ext} build failed. Push aborted."
        exit 1
    fi
done

# Build webapp (catches TS errors via Next.js build)
echo "ğŸ“¦ Building webapp..."
if bun run --filter "@docs.plus/webapp" build:local; then
    echo "âœ… Webapp build successful"
else
    echo "âŒ Webapp build failed. Push aborted."
    exit 1
fi

echo "ğŸš€ All pre-push checks passed. Proceeding with push."
